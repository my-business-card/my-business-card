jQuery.widget("gc.liteForm",{options:{},_create:function(){var a=this;this.formContentBlock=this.element.find(".form-content");this.resultBlock=this.element.find(".form-result-block");0<$(this.element).find(".hide-form-if-no-positions").length&&0==$(this.element).find(".form-position").length&&this.element.hide();var c=addGlobalCheckbox(this.element);$(this.element).submit(function(){c()&&a.sendForm();return!1})},resetState:function(){this.resultBlock.removeClass("error");this.resultBlock.removeClass("success");
this.resultBlock.hide();this.resultBlock.html("");this.formContentBlock.show()},dealId:null,breakedOn:null,sendForm:function(){this.resultBlock.removeClass("error");this.resultBlock.removeClass("success");this.resultBlock.hide();var a=this.element,c=!1;$(this.element).find(".required-one-selected").each(function(){for(var b=$(this).val().split(","),d=0;d<b.length;d++)if(a.find(".form-position-offer-"+b[d]+":checked").length)return;c=!0});if(c)alert("\u0414\u043e\u043b\u0436\u043d\u043e \u0431\u044b\u0442\u044c \u0432\u044b\u0431\u0440\u0430\u043d\u043e \u043f\u0440\u0435\u0434\u043b\u043e\u0436\u0435\u043d\u0438\u0435");
else{var b=this,e=this.element.attr("action"),d=$(this.element).serialize();d&&""!=d||(d={});"object"==typeof d?d.fromUrl=encodeURIComponent(location.href):d=d+"&fromUrl="+encodeURIComponent(location.href);this.breakedOn&&(d=d+"&formParams[breakedOn]="+this.breakedOn);this.dealId&&(d=d+"&formParams[dealId]="+this.dealId);$(this.element).find('input[type="checkbox"].form-position-input').not(":checked").each(function(a,b){d=d+"&formParams[not_selected_offer_id][]="+$(b).val()});$(this.element).find('input[type="radio"].prolong-offer').not(":checked").each(function(a,
b){0!=$(b).attr("data-offer-id")&&(d=d+"&formParams[not_selected_offer_id][]="+$(b).attr("data-offer-id"))});$(this.element).find('input[type="radio"].prolong-offer:checked').each(function(a,b){0!=$(b).attr("data-offer-id")&&(d=d+"&formParams[offer_id][]="+$(b).attr("data-offer-id"))});this.resultBlock.html("");b.lastSend&&4E3>Date.now()-b.lastSend&&alert("\u0417\u0430\u043f\u0440\u043e\u0441 \u0435\u0449\u0435 \u043e\u0431\u0440\u0430\u0431\u0430\u0442\u044b\u0432\u0430\u0435\u0442\u0441\u044f");
b.lastSend=Date.now();ajaxCall(e,d,{enableSimpleSign:!0},function(a){b.lastSend=null;b.breakedOn=a.data.breakedOn;a.data.dealId&&(b.dealId=a.data.dealId);if(a.data.formProcessed){if(a.data.preParts)for(key in a.data.preParts){var c=a.data.preParts[key];c.javascript&&eval(c.javascript);c.html&&b.resultBlock.html(c.html)}if(a.data.redirectUrl&&!a.data.noRedirect&&(c=a.data.redirectUrl,a.data.confirmMessage&&a.data.confirmCancelRedirectUrl&&!confirm(a.data.confirmMessage)&&(c=a.data.confirmCancelRedirectUrl),
window.top!==window.window?window.top.location.href=c:window.location.href=c,!a.data.refreshPage))return;if(a.data.refreshPage)window.location.reload();else{b.resultBlock.html("<h3 class='text-center'>"+a.data.defaultMessage+"</h3>");for(key in a.data.parts)c=a.data.parts[key],c.html&&b.resultBlock.html(c.html);b.element.height(b.element.height());b.resultBlock.show();b.formContentBlock.hide()}}else b.resultBlock.show(),b.resultBlock.html("<div class='error-message'>"+a.data.error+"</div>"),b.resultBlock.addClass("error")})}}});
function ltShowModalBlock(a,c){var b=null,b=$("#"+a);0==b.length&&(b=$("[data-code='"+a+"']"));if(c)for(key in c){var e=c[key];b.find(".external-value."+key).val(e)}if(b.hasClass("lt-modal-block")){var d=window.gcModalFactory.create();b.data("modal-width")&&""!=b.data("modal-width")?d.getModalEl().find(".modal-dialog").width(b.data("modal-width")):d.getModalEl().find(".modal-dialog").width("500px");d.setContent("");d.getModalEl().addClass("lt-block-modal-window");b.appendTo(d.getContentEl());b.show()}else bodyScrollTo(b,
10);d.get$Modal().on("hidden.bs.modal",function(a){(a=$(this).find(".videoWrapper iframe"))&&a.attr("src",a.attr("src"))})}
function ltShowModalForm(a){if("custom"==a.formType){var c={};a.position&&a.position.offer_id&&(c.offer_id=a.position.offer_id);ltShowModalBlock(a.formBlockCode,c)}else{var b=window.gcModalFactory.create();b.getModalEl().addClass("lt-block-modal-window");b.getModalEl().addClass("lt-form-modal-window");ajaxCall("/pl/lite/block-public/get-block-html",a,{},function(a){b.setContent(a.data.html)})}}
jQuery.widget("gc.liteSinglyForm",{currentPartIndex:0,_create:function(){this.element.show();var a=this;this.element.find("input,select").change(function(){a.checkNextAvailable()});this.element.find("input,textarea").keyup(function(){a.checkNextAvailable()});this.surveyFieldsBlock=this.element.find(".part-surveyFields");this.otherFieldsBlocks=this.element.find(".builder-item:not(.part-surveyFields)");var c=$('<div class="btn-singly-controls"></div>');c.appendTo(this.element.find(".builder"));this.progressBar=
$('<div class="progress-bar-wrapper"><div class="progress-bar"></div></div>');this.progressBar.prependTo(this.element.find(".builder"));var b=this.surveyFieldsBlock.find(".field-wrapper");this.prevBtn=$('<button type="button" class="btn btn-prev btn-default">\u041d\u0430\u0437\u0430\u0434</button>');this.prevBtn.appendTo(c);this.nextBtn=$('<button type="button" class="btn btn-next btn-success">\u0414\u0430\u043b\u0435\u0435</button>');this.nextBtn.appendTo(c);this.nextBtn.click(function(){a.next()});
this.prevBtn.click(function(){a.prev()});var e=[];b.each(function(a,b){e.push($(b))});e.push(this.otherFieldsBlocks);this.parts=e;this.showCurrentPart()},showCurrentPart:function(){for(var a=0;a<this.parts.length;a++)a==this.currentPartIndex?this.parts[a].show():this.parts[a].hide();this.prevBtn.show();this.nextBtn.show();this.currentPartIndex==this.parts.length-1&&(this.prevBtn.hide(),this.nextBtn.hide());0==this.currentPartIndex&&this.prevBtn.hide();1<this.parts.length?(a=Math.round(100*this.currentPartIndex/
(this.parts.length-1)),this.currentPartIndex>=this.parts.length-1&&this.progressBar.hide(),this.progressBar.find(".progress-bar").width(a+"%")):this.progressBar.hide();this.checkNextAvailable()},checkNextAvailable:function(){var a=this.parts[this.currentPartIndex];0<a.find(".type-select.required,.type-multi_select.required").length&&0==a.find("input:checked").length&&("undefined"==typeof a.find("select").val()||""==a.find("select").val())?this.nextBtn.attr("disabled","disabled"):0<a.find(".type-string.required").length&&
""==a.find("input").val()?this.nextBtn.attr("disabled","disabled"):0<a.find(".type-text").length&&""==a.find("textarea").val()?this.nextBtn.attr("disabled","disabled"):this.nextBtn.removeAttr("disabled")},next:function(){this.currentPartIndex<this.parts.length-1&&(this.currentPartIndex++,this.showCurrentPart())},prev:function(){0<this.currentPartIndex&&(this.currentPartIndex--,this.showCurrentPart())}});
$(function(){$(".lt-singly-form-survey").each(function(a,c){$(c).hasClass("lt-editing")||($(c).hide(),$(c).liteSinglyForm())})});
jQuery.widget("gc.liteMenu",{options:{position:"static"},placeholder:null,currentAnchorLink:null,_create:function(){var a=this;this.element.find(".toggler").click(function(){$(this).parents(".menu-wrapper").toggleClass("expanded")});this.element.find(".collapsed-content .f-header").click(function(){$(this).parents(".menu-wrapper").toggleClass("expanded")});"sticky"==this.options.position&&($placeholder=$('<div class="lt-menu-placeholder"></div>'),$placeholder.insertBefore(this.element),this.placeholder=
$placeholder);var c=$(".anchor"),b={};this.element.find(".menu-list a").each(function(){var c=$(this).attr("href");0==c.indexOf("#")&&(b[c.substring(1)]=$(this),$(this).click(function(){var b=$($(this).attr("href"));if(b.length)return 980>=$(window).width()&&a.element.find(".menu-wrapper").toggleClass("expanded"),$("body,html").animate({scrollTop:Math.round(b.offset().top)},300),history.pushState(null,null,$(this).attr("href")),!1}))});$(window).scroll(function(){var e=$(this).scrollTop()+20,d=a.element;
0==e?d.removeClass("scrolled"):d.addClass("scrolled");prevAnchorEl=null;for(var f=0;f<c.length;f++){var g=c.eq(f);if(g.offset().top>e)break;prevAnchorEl=g}newAnchorLink=prevAnchorEl?b[prevAnchorEl.data("anchor")]:null;a.currentAnchorLink!=newAnchorLink&&(a.currentAnchorLink&&a.currentAnchorLink.parents("li").removeClass("active"),a.currentAnchorLink=newAnchorLink,a.currentAnchorLink&&a.currentAnchorLink.parents("li").addClass("active"));a.placeholder&&a.placeholder.offset().top<e?(a.placeholder.height(d.height()),
d.addClass("scroll-passed")):(a.placeholder&&a.placeholder.height("auto"),d.removeClass("scroll-passed"))})}});
jQuery.widget("gc.liteVideoCover",{player:null,options:{type:null,videoId:null},_create:function(){var a=this;this.playerWrapperEl=$('<div class="player-wrapper"></div>');this.playerWrapperEl.appendTo(this.element);"youtube"==this.options.type?this.loadYoutubeApi():this.loadVimeo();$(window).on("load resize",function(){a.rescaleVideo()})},loadVimeo:function(){var a=document.createElement("script");a.src="//f.vimeocdn.com/js/froogaloop2.min.js";var c=document.getElementsByTagName("script")[0];c.parentNode.insertBefore(a,
c);$player=$('<iframe class="player" src="https://player.vimeo.com/video/'+this.options.videoId+'?api=1&background=1&loop=1&autoplay=1&title=0&byline=0&portrait=0" width="640" height="360" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>');$player.appendTo(this.playerWrapperEl);a.onload=function(){var a=$f($player[0]);a.addEvent("ready",function(){a.api("setVolume",0)})}},loadYoutubeApi:function(){var a=this,c=document.createElement("script");c.src="https://www.youtube.com/player_api";
var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(c,b);window.ytPlayerLoadHandlers.push(function(){a.playerLoaded()})},playerLoaded:function(){var a=this;this.playerEl=$('<div class="player"></div>');this.playerEl.appendTo(this.playerWrapperEl);this.player=new YT.Player(this.playerEl.get(0),{events:{onReady:function(){a.onPlayerReady()},onStateChange:function(c){a.onPlayerStateChange(c)}},playerVars:{autoplay:0,autohide:1,modestbranding:0,rel:0,showinfo:0,controls:0,disablekb:1,
enablejsapi:0,iv_load_policy:3}})},onPlayerReady:function(){this.player.loadVideoById({videoId:this.options.videoId,startSeconds:0,endSeconds:0,suggestedQuality:"hd720"});this.player.mute()},onPlayerStateChange:function(a){1===a.data?this.playerWrapperEl.find(".player").addClass("active"):0===a.data&&this.player.seekTo(0)},rescaleVideo:function(){var a=this.element.width()+200,c=this.element.height()+200,b=this.playerWrapperEl.find(".player");a/c>16/9?("youtube"==this.options.type?this.player.setSize(a,
a/16*9):(b.css("width",a),b.css("height",a/16*9)),b.css({left:"0px"})):("youtube"==this.options.type?this.player.setSize(c/9*16,c):(b.css("width",c/9*16),b.css("height",c)),b.css({left:-(b.outerWidth()-a)/2}));b.addClass("active")}});window.ytPlayerLoadHandlers||(window.ytPlayerLoadHandlers=[]);function onYouTubePlayerAPIReady(){for(var a=0;a<window.ytPlayerLoadHandlers.length;a++)window.ytPlayerLoadHandlers[a]()}
function vidRescale(){var a=$(window).width()+200,c=$(window).height()+200;a/c>16/9?(tv.setSize(a,a/16*9),$(".tv .screen").css({left:"0px"})):(tv.setSize(c/9*16,c),$(".tv .screen").css({left:-($(".tv .screen").outerWidth()-a)/2}))}$(window).on("load resize",function(){});
function ltGetBasketEl(){window.ltBasketEl||(window.ltBasketEl=$('<div class="lt-basket"></div>'),window.ltBasketEl.hide(),window.ltBasketEl.appendTo(document.body),window.ltBasketEl.liteBasket(),window.ltBasketEl.addClass("basket-collapsed"));return window.ltBasketEl}window.ltBasketFormCode=null;function ltBasketSetFormCode(a){window.ltBasketFormCode=a}window.ltCheckBasketRunned=!1;
function ltCheckBasket(a){if(a||!window.ltCheckBasketRunned)ltBasketEl=ltGetBasketEl(),ltBasketEl.liteBasket("getBasketData"),window.ltCheckBasketRunned=!0}function ltAddToBasket(a){ltBasketEl=ltGetBasketEl();ltBasketEl.liteBasket("addOffer",a);ltBasketEl.show()}
jQuery.widget("gc.liteBasket",{options:{},_create:function(){var a=this,c=null;this.offers={};this.totalEl=$('<div class="total-view"></div>');this.collapsedEl=$('<div class="collapsed-view"></div>');this.totalEl.appendTo(this.element);this.collapsedEl.appendTo(this.element);"en"==window.language?this.collapsedEl.html("Basket has <span class='positions-count-str'></span> cost <br/><span class='old-total-cost-str'></span>&nbsp;<span class='total-cost-str'></span> <br/> <div class='buttons'><button class='btn expand-btn btn-success'> <span class='fa fa-chevron-down'></span> Open cart</button> <button class='btn btn-deal btn-danger'> <span class='fa fa-shopping-basket'></span> Order</button></div>"):
this.collapsedEl.html("\u0412 \u043a\u043e\u0440\u0437\u0438\u043d\u0435 <span class='positions-count-str'></span> \u043d\u0430 \u0441\u0443\u043c\u043c\u0443 <br/><span class='old-total-cost-str'></span>&nbsp;<span class='total-cost-str'></span> <br/> <div class='buttons'><button class='btn expand-btn btn-success'> <span class='fa fa-chevron-down'></span> \u041f\u043e\u043a\u0430\u0437\u0430\u0442\u044c</button> <button class='btn btn-deal btn-danger'> <span class='fa fa-shopping-basket'></span> \u0417\u0430\u043a\u0430\u0437\u0430\u0442\u044c</button></div>");
this.collapsedEl.find(".expand-btn").click(function(){a.expand()});this.closeBtn=$('<span class="close-btn fa fa-times"></span>');this.closeBtn.appendTo(this.totalEl);this.closeBtn.click(function(){a.collapse()});c="en"==window.language?"Shopping Cart":"\u041a\u043e\u0440\u0437\u0438\u043d\u0430";this.headerEl=$('<h3 class="header">'+c+"</h3>");this.headerEl.appendTo(this.totalEl);this.tableWrapper=$('<div class="table-wrapper"/>');this.tableWrapper.appendTo(this.totalEl);this.table=$('<table class="positions-table table-vertical-middle table" ></table>');
this.table.appendTo(this.tableWrapper);c="en"==window.language?"Order":"\u041e\u0444\u043e\u0440\u043c\u0438\u0442\u044c \u0437\u0430\u043a\u0430\u0437";this.buttonEl=$('<button class="btn btn-deal btn-success f-btn">'+c+"</button>");this.buttonEl.appendTo(this.totalEl);this.element.find(".btn-deal").click(function(){window.ltBasketFormCode?ltShowModalBlock(window.ltBasketFormCode,{offer_id:-2}):ltShowModalForm({preset:"formCommon01",formType:"deal",position:{offer_id:-2}})})},addOffer:function(a){var c=
this;ajaxCall("/sales/shop/basketAddOffer",{offerId:a,quantity:1},{},function(a){c.updateBasketData(a.data.basket)})},deleteOffer:function(a){},getBasketData:function(){var a=this;ajaxCall("/sales/shop/basket",{},{},function(c){a.updateBasketData(c.data.basket)})},updateBasketData:function(a){this.table.empty();var c=this;if(response.data.basket.is_empty)this.element.hide();else{this.element.show();this.collapsedEl.find(".positions-count-str").html(a.total_quantity_str);this.collapsedEl.find(".total-cost-str").html(a.cost_str);
this.collapsedEl.find(".old-total-cost-str").html(a.old_cost_str);for(var b in a.positions){var e=a.positions[b],d=b,f=$('<tr> <td><span class="fa btn-delete-position fa-trash"></span></td> <td class="offer-title"></td> <td class="offer-count-td"><input type="text" size=5 style="width: 60px; text-align: center" class="text-center form-control offer-count"/></td><td style="width: 20px">&times;</td> <td><div class="old-offer-price"></div><div class="offer-price"></div></td>  </tr>');f.data("offer-id",
d);f.find(".offer-title").html(e.offer.title);f.find(".offer-count").val(e.quantity);f.find(".offer-price").html(e.price_str);e.old_price_str&&f.find(".old-offer-price").html(e.old_price_str);f.appendTo(c.table);f.find(".offer-count").change(function(){var a=$(this).parents("tr").data("offer-id"),b=$(this).val();ajaxCall("/sales/shop/basketChangeOfferQuantity",{offerId:a,quantity:b},{},function(a){c.updateBasketData(a.data.basket)})});f.find(".btn-delete-position").click(function(){var a=$(this).parents("tr").data("offer-id");
ajaxCall("/sales/shop/basketDeleteOffer",{offerId:a},{},function(a){c.updateBasketData(a.data.basket)})})}label="en"==window.language?"Total cost":"\u0421\u0443\u043c\u043c\u0430 \u0437\u0430\u043a\u0430\u0437\u0430";f=$('<tr class="total-row"> <td colspan="2" class="offer-title">'+label+'</td> <td colspan="3" align="right"><span class="old-total-price"></span>&nbsp;<span class="total-price"></span></td> </tr>');f.find(".total-price").html(a.cost_str);a.old_cost_str&&f.find(".old-total-price").html(a.old_cost_str);
f.appendTo(c.table)}},loadOffersInfo:function(){},collapse:function(){this.element.addClass("basket-collapsed")},expand:function(){this.element.removeClass("basket-collapsed")}});
